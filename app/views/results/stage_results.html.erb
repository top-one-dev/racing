<h3><%= link_to @race.name, race_path(@race) %> &nbsp;-&nbsp; <%= link_to 'Manage Results', manage_result_path(@race) %> &nbsp;-&nbsp; <%= @stage.name %> </h3>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <th>Time</th>
      <th>Strava Activity URL</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @cyclists.each_with_index do |cyclist| %>
    <% stage_effort = cyclist.stage_efforts.find_by(stage_id: @stage) %>
      <tr>
        <td><%= link_to cyclist.name, cyclist.strava_athlete_url %></td>
        <% if stage_effort %>
          <td><%= Time.at(stage_effort.elapsed_time).utc.strftime('%H:%M:%S') if stage_effort.elapsed_time %></td>
          <td><%= link_to stage_effort.strava_activity_url, stage_effort.strava_activity_url %></td>    
          <td><%= link_to 'Update Result', edit_stage_effort_path(@race, @stage, cyclist, stage_effort) %></td>        
        <%else%>
          <td></td>
          <td></td>    
          <td><%= link_to 'Add Result', new_stage_effort_path(@race, @stage, cyclist) %></td>    
        <%end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<h3>Stage Leaderboard</h3>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Place</th>
      <th>Points</th>
      <th>Name</th>
      <th>Total time</th>
    </tr>
  </thead>

  <tbody>
    <% @cyclists.each_with_index do |cyclist, index| %>
      <% stage_effort = cyclist.stage_efforts.find_by(stage_id: @stage) %>
      <% if stage_effort %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= 5.0 %></td>        
          <td><%= cyclist.name %></td>
          <td><%= Time.at(stage_effort.elapsed_time).utc.strftime('%H:%M:%S') if stage_effort.elapsed_time %></td>                
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>